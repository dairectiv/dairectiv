openapi: 3.1.0
info:
    title: Dairectiv
    version: 1.0.0
    description: AI enablement hub for engineering teams - API for authoring, versioning, and governing AI guidance
servers:
    - url: http://127.0.0.1/api
      description: Local development server
tags:
    - name: Rules
      description: Rule management endpoints
    - name: Workflows
      description: Workflow management endpoints

paths:
    /authoring/rules:
        post:
            tags:
                - Rules
            summary: Draft a new rule
            description: Creates a new rule in draft state with the provided name and description
            operationId: draftRule
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/DraftRulePayload"
            responses:
                "201":
                    description: Rule drafted successfully
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/RuleResponse"
                "409":
                    description: Directive with this name already exists
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"
                "422":
                    description: Validation error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ValidationErrorResponse"

    /authoring/rules/{id}:
        get:
            tags:
                - Rules
            summary: Get a rule by ID
            description: Retrieves a single rule with all its details including examples
            operationId: getRule
            parameters:
                - name: id
                  in: path
                  required: true
                  description: The unique identifier of the rule
                  schema:
                      type: string
                      pattern: "^[a-z0-9-]+$"
                      examples:
                          - "my-rule-id"
            responses:
                "200":
                    description: Rule found and returned successfully
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/RuleResponse"
                "404":
                    description: Rule not found
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"
        patch:
            tags:
                - Rules
            summary: Update a rule
            description: Partially updates a rule. Only provided fields will be updated.
            operationId: updateRule
            parameters:
                - name: id
                  in: path
                  required: true
                  description: The unique identifier of the rule
                  schema:
                      type: string
                      pattern: "^[a-z0-9-]+$"
                      examples:
                          - "my-rule-id"
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/UpdateRulePayload"
            responses:
                "200":
                    description: Rule updated successfully
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/RuleResponse"
                "400":
                    description: Bad request (no fields provided or rule is archived)
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"
                "404":
                    description: Rule not found
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"
                "422":
                    description: Validation error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ValidationErrorResponse"

    /authoring/rules/{id}/publish:
        post:
            tags:
                - Rules
            summary: Publish a rule
            description: Publishes a rule that is currently in draft state. A published rule cannot be edited but is visible to AI tools.
            operationId: publishRule
            parameters:
                - name: id
                  in: path
                  required: true
                  description: The unique identifier of the rule
                  schema:
                      type: string
                      pattern: "^[a-z0-9-]+$"
                      examples:
                          - "my-rule-id"
            responses:
                "200":
                    description: Rule published successfully
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/RuleResponse"
                "404":
                    description: Rule not found
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"
                "409":
                    description: Rule cannot be published (already published or archived)
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"

    /authoring/rules/{id}/archive:
        post:
            tags:
                - Rules
            summary: Archive a rule
            description: Archives a rule that is in draft or published state. An archived rule is no longer visible to AI tools and cannot be edited.
            operationId: archiveRule
            parameters:
                - name: id
                  in: path
                  required: true
                  description: The unique identifier of the rule
                  schema:
                      type: string
                      pattern: "^[a-z0-9-]+$"
                      examples:
                          - "my-rule-id"
            responses:
                "200":
                    description: Rule archived successfully
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/RuleResponse"
                "404":
                    description: Rule not found
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"
                "409":
                    description: Rule cannot be archived (already archived)
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"

    /authoring/rules/{id}/examples:
        post:
            tags:
                - Rules
            summary: Add an example to a rule
            description: Adds a new example to an existing rule with good and bad usage patterns
            operationId: addRuleExample
            parameters:
                - name: id
                  in: path
                  required: true
                  description: The unique identifier of the rule
                  schema:
                      type: string
                      pattern: "^[a-z0-9-]+$"
                      examples:
                          - "my-rule-id"
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/AddRuleExamplePayload"
            responses:
                "201":
                    description: Example added successfully
                    headers:
                        Location:
                            description: URL of the created example resource
                            schema:
                                type: string
                                format: uri
                                examples:
                                    - "http://127.0.0.1/api/authoring/rules/my-rule-id/examples/019b7460-798e-77f8-af01-bc6ab6e25f84"
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/RuleExampleResponse"
                "400":
                    description: Bad request (rule is archived)
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"
                "404":
                    description: Rule not found
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"
                "422":
                    description: Validation error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ValidationErrorResponse"

    /authoring/rules/{id}/examples/{exampleId}:
        patch:
            tags:
                - Rules
            summary: Update a rule example
            description: Partially updates an example on a rule. Only provided fields will be updated.
            operationId: updateRuleExample
            parameters:
                - name: id
                  in: path
                  required: true
                  description: The unique identifier of the rule
                  schema:
                      type: string
                      pattern: "^[a-z0-9-]+$"
                      examples:
                          - "my-rule-id"
                - name: exampleId
                  in: path
                  required: true
                  description: The unique identifier of the example
                  schema:
                      type: string
                      pattern: "^[a-z0-9-]+$"
                      examples:
                          - "019b7460-798e-77f8-af01-bc6ab6e25f84"
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/UpdateRuleExamplePayload"
            responses:
                "200":
                    description: Example updated successfully
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/RuleExampleResponse"
                "400":
                    description: Bad request (no fields provided or rule is archived)
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"
                "404":
                    description: Rule or example not found
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"
        delete:
            tags:
                - Rules
            summary: Remove an example from a rule
            description: Removes an example from a rule. The example will be permanently deleted.
            operationId: removeRuleExample
            parameters:
                - name: id
                  in: path
                  required: true
                  description: The unique identifier of the rule
                  schema:
                      type: string
                      pattern: "^[a-z0-9-]+$"
                      examples:
                          - "my-rule-id"
                - name: exampleId
                  in: path
                  required: true
                  description: The unique identifier of the example to remove
                  schema:
                      type: string
                      pattern: "^[a-z0-9-]+$"
                      examples:
                          - "019b7460-798e-77f8-af01-bc6ab6e25f84"
            responses:
                "204":
                    description: Example removed successfully
                "404":
                    description: Rule or example not found
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"

    /authoring/workflows/{id}:
        get:
            tags:
                - Workflows
            summary: Get a workflow by ID
            description: Retrieves a single workflow with all its details including examples and steps
            operationId: getWorkflow
            parameters:
                - name: id
                  in: path
                  required: true
                  description: The unique identifier of the workflow
                  schema:
                      type: string
                      pattern: "^[a-z0-9-]+$"
                      examples:
                          - "my-workflow-id"
            responses:
                "200":
                    description: Workflow found and returned successfully
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/WorkflowResponse"
                "404":
                    description: Workflow not found
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ErrorResponse"

components:
    schemas:
        RuleResponse:
            type: object
            required:
                - id
                - createdAt
                - updatedAt
                - state
                - name
                - description
                - examples
            properties:
                id:
                    type: string
                    description: Unique identifier of the rule
                    examples:
                        - "my-rule-id"
                createdAt:
                    type: string
                    format: date-time
                    description: Timestamp when the rule was created
                    examples:
                        - "2025-12-31T12:00:00+00:00"
                updatedAt:
                    type: string
                    format: date-time
                    description: Timestamp when the rule was last updated
                    examples:
                        - "2025-12-31T12:00:00+00:00"
                state:
                    $ref: "#/components/schemas/DirectiveState"
                name:
                    type: string
                    description: Name of the rule
                    examples:
                        - "My Rule"
                description:
                    type: string
                    description: Description of the rule
                    examples:
                        - "A detailed description of what this rule does"
                content:
                    type:
                        - string
                        - "null"
                    description: The actual content/body of the rule
                    examples:
                        - "Always use descriptive variable names"
                examples:
                    type: array
                    description: List of examples demonstrating the rule
                    items:
                        $ref: "#/components/schemas/RuleExampleResponse"

        RuleExampleResponse:
            type: object
            required:
                - id
                - createdAt
                - updatedAt
            properties:
                id:
                    type: string
                    description: Unique identifier of the example
                    examples:
                        - "019b7460-798e-77f8-af01-bc6ab6e25f84"
                createdAt:
                    type: string
                    format: date-time
                    description: Timestamp when the example was created
                    examples:
                        - "2025-12-31T12:00:00+00:00"
                updatedAt:
                    type: string
                    format: date-time
                    description: Timestamp when the example was last updated
                    examples:
                        - "2025-12-31T12:00:00+00:00"
                good:
                    type:
                        - string
                        - "null"
                    description: Example of correct/good usage
                    examples:
                        - "const userAge = 25;"
                bad:
                    type:
                        - string
                        - "null"
                    description: Example of incorrect/bad usage
                    examples:
                        - "const x = 25;"
                explanation:
                    type:
                        - string
                        - "null"
                    description: Explanation of why the good example is better
                    examples:
                        - "Descriptive names improve code readability"

        WorkflowResponse:
            type: object
            required:
                - id
                - createdAt
                - updatedAt
                - state
                - name
                - description
                - examples
                - steps
            properties:
                id:
                    type: string
                    description: Unique identifier of the workflow
                    examples:
                        - "my-workflow-id"
                createdAt:
                    type: string
                    format: date-time
                    description: Timestamp when the workflow was created
                    examples:
                        - "2025-12-31T12:00:00+00:00"
                updatedAt:
                    type: string
                    format: date-time
                    description: Timestamp when the workflow was last updated
                    examples:
                        - "2025-12-31T12:00:00+00:00"
                state:
                    $ref: "#/components/schemas/DirectiveState"
                name:
                    type: string
                    description: Name of the workflow
                    examples:
                        - "My Workflow"
                description:
                    type: string
                    description: Description of the workflow
                    examples:
                        - "A detailed description of what this workflow does"
                content:
                    type:
                        - string
                        - "null"
                    description: The actual content/body of the workflow
                    examples:
                        - "This workflow guides you through the process"
                examples:
                    type: array
                    description: List of examples demonstrating the workflow
                    items:
                        $ref: "#/components/schemas/WorkflowExampleResponse"
                steps:
                    type: array
                    description: Ordered list of steps in the workflow
                    items:
                        $ref: "#/components/schemas/StepResponse"

        WorkflowExampleResponse:
            type: object
            required:
                - id
                - createdAt
                - updatedAt
                - scenario
                - input
                - output
            properties:
                id:
                    type: string
                    description: Unique identifier of the example
                    examples:
                        - "019b7460-798e-77f8-af01-bc6ab6e25f84"
                createdAt:
                    type: string
                    format: date-time
                    description: Timestamp when the example was created
                    examples:
                        - "2025-12-31T12:00:00+00:00"
                updatedAt:
                    type: string
                    format: date-time
                    description: Timestamp when the example was last updated
                    examples:
                        - "2025-12-31T12:00:00+00:00"
                scenario:
                    type: string
                    description: Description of the scenario
                    examples:
                        - "User wants to create a new account"
                input:
                    type: string
                    description: Input for the scenario
                    examples:
                        - "User provides email and password"
                output:
                    type: string
                    description: Expected output for the scenario
                    examples:
                        - "Account is created and confirmation email is sent"
                explanation:
                    type:
                        - string
                        - "null"
                    description: Additional explanation of the example
                    examples:
                        - "This demonstrates the happy path for account creation"

        StepResponse:
            type: object
            required:
                - id
                - createdAt
                - updatedAt
                - order
                - content
            properties:
                id:
                    type: string
                    description: Unique identifier of the step
                    examples:
                        - "019b7460-798e-77f8-af01-bc6ab6e25f84"
                createdAt:
                    type: string
                    format: date-time
                    description: Timestamp when the step was created
                    examples:
                        - "2025-12-31T12:00:00+00:00"
                updatedAt:
                    type: string
                    format: date-time
                    description: Timestamp when the step was last updated
                    examples:
                        - "2025-12-31T12:00:00+00:00"
                order:
                    type: integer
                    description: Position of the step in the workflow (1-based)
                    examples:
                        - 1
                content:
                    type: string
                    description: Content/instructions of the step
                    examples:
                        - "First, analyze the requirements"

        DirectiveState:
            type: string
            description: The current state of a directive (rule or workflow)
            enum:
                - draft
                - published
                - archived
            examples:
                - "draft"

        DraftRulePayload:
            type: object
            required:
                - name
                - description
            properties:
                name:
                    type: string
                    description: Name of the rule
                    minLength: 1
                    maxLength: 255
                    examples:
                        - "My Rule"
                description:
                    type: string
                    description: Description of the rule
                    minLength: 1
                    maxLength: 500
                    examples:
                        - "A detailed description of what this rule does"

        UpdateRulePayload:
            type: object
            description: Payload for updating a rule. All fields are optional, but at least one must be provided.
            properties:
                name:
                    type: string
                    description: Name of the rule
                    maxLength: 255
                    examples:
                        - "Updated Rule Name"
                description:
                    type: string
                    description: Description of the rule
                    maxLength: 500
                    examples:
                        - "An updated description of what this rule does"
                content:
                    type: string
                    description: The actual content/body of the rule
                    examples:
                        - "Always use descriptive variable names"

        AddRuleExamplePayload:
            type: object
            description: Payload for adding an example to a rule
            required:
                - good
                - bad
            properties:
                good:
                    type: string
                    description: Example of correct/good usage
                    minLength: 1
                    examples:
                        - "const userAge = 25;"
                bad:
                    type: string
                    description: Example of incorrect/bad usage
                    minLength: 1
                    examples:
                        - "const x = 25;"
                explanation:
                    type:
                        - string
                        - "null"
                    description: Optional explanation of why the good example is better
                    examples:
                        - "Descriptive names improve code readability"

        UpdateRuleExamplePayload:
            type: object
            description: Payload for updating an example on a rule. All fields are optional, but at least one must be provided.
            properties:
                good:
                    type: string
                    description: Example of correct/good usage
                    examples:
                        - "const userAge = 25;"
                bad:
                    type: string
                    description: Example of incorrect/bad usage
                    examples:
                        - "const x = 25;"
                explanation:
                    type:
                        - string
                        - "null"
                    description: Explanation of why the good example is better
                    examples:
                        - "Descriptive names improve code readability"

        ErrorResponse:
            type: object
            required:
                - type
                - title
                - status
            properties:
                type:
                    type: string
                    description: URI reference identifying the error type
                    examples:
                        - "https://tools.ietf.org/html/rfc2616#section-10"
                title:
                    type: string
                    description: Short summary of the error
                    examples:
                        - "An error occurred"
                status:
                    type: integer
                    description: HTTP status code
                    examples:
                        - 404
                detail:
                    type: string
                    description: Detailed error message
                    examples:
                        - "Rule with ID non-existent-rule not found."

        ValidationErrorResponse:
            type: object
            required:
                - type
                - title
                - status
                - violations
            properties:
                type:
                    type: string
                    description: URI reference identifying the error type
                    examples:
                        - "https://symfony.com/errors/validation"
                title:
                    type: string
                    description: Short summary of the error
                    examples:
                        - "Validation Failed"
                status:
                    type: integer
                    description: HTTP status code
                    examples:
                        - 422
                detail:
                    type: string
                    description: Detailed error message
                    examples:
                        - "name: This value should not be blank."
                violations:
                    type: array
                    description: List of validation violations
                    items:
                        $ref: "#/components/schemas/ValidationViolation"

        ValidationViolation:
            type: object
            required:
                - propertyPath
                - title
            properties:
                propertyPath:
                    type: string
                    description: The property that failed validation
                    examples:
                        - "name"
                title:
                    type: string
                    description: The validation error message
                    examples:
                        - "This value should not be blank."
                template:
                    type: string
                    description: The validation error message template
                    examples:
                        - "This value should not be blank."
                parameters:
                    type: object
                    description: Parameters for the validation error message
                    additionalProperties: true
                type:
                    type: string
                    description: The validation constraint type that failed
                    examples:
                        - "urn:uuid:c1051bb4-d103-4f74-8988-acbcafc7fdc3"
